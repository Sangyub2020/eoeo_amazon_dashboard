# 데이터베이스 구조 설명

## 📊 2단계 마스터 구조

채널별로 필요한 정보가 다르고, 모든 채널을 묶는 Internal Code가 있기 때문에 **2단계 마스터 구조**를 사용합니다.

### 1단계: `product_master` (제품 마스터)

**목적**: 회사 내부 제품 코드(Internal Code) 기준으로 모든 채널에서 공통으로 사용하는 정보

**주요 필드**:
- `internal_code`: 회사 내부 제품 코드 (모든 채널에서 동일, 고유값)
- `barcode`: 바코드
- `product_name`: 제품명
- `company_name`: 회사명
- `brand_name`: 브랜드명

**예시**:
```
Internal Code: "PROD-001"
Product Name: "비타민C 1000mg"
Company: "이공이공"
Brand: "브랜드A"
```

### 2단계: `sku_master` (SKU 마스터)

**목적**: 각 채널별로 다른 SKU와 채널별 특화 정보

**주요 필드**:
- `internal_code`: 제품 마스터 참조 (선택사항, 있으면 연결)
- `sku`: 채널별 SKU (고유값)
- `channel`: 채널 (amazon_us, tiktok_shop, shopify)
- `child_asin`: Amazon 전용
- `manager`: 담당자 (하위 마스터로 이동)
- `contract_type`: 계약 형태 (하위 마스터로 이동)
- `profit_sheet_id`: ProfitSheet ID (하위 마스터로 이동)
- `amazon_account_name`: Amazon 전용
- `sales_price`: 판매가
- `supply_cost_won`: 공급가
- `channel_specific_data`: 채널별 특화 데이터 (JSON)

**예시**:
```
Internal Code: "PROD-001" (같은 제품)
SKU: "AMZ-PROD-001" (Amazon)
Channel: "amazon_us"
Child ASIN: "B08XYZ123"

Internal Code: "PROD-001" (같은 제품)
SKU: "TTK-PROD-001" (TikTok Shop)
Channel: "tiktok_shop"
```

## 🔗 관계 구조

```
product_master (1) ──< (N) sku_master (1) ──< (N) sku_monthly_data
     ↑                        ↑                        ↑
  Internal Code          채널별 SKU              월별 데이터
```

## 📝 사용 시나리오

### 시나리오 1: Internal Code가 있는 경우 (권장)

1. **제품 마스터 먼저 생성**
```sql
INSERT INTO product_master (internal_code, product_name, company_name, brand_name)
VALUES ('PROD-001', '비타민C 1000mg', '이공이공', '브랜드A');
```

2. **각 채널별 SKU 생성**
```sql
-- Amazon
INSERT INTO sku_master (internal_code, sku, channel, child_asin, amazon_account_name)
VALUES ('PROD-001', 'AMZ-PROD-001', 'amazon_us', 'B08XYZ123', 'Amazon Account 1');

-- TikTok Shop
INSERT INTO sku_master (internal_code, sku, channel)
VALUES ('PROD-001', 'TTK-PROD-001', 'tiktok_shop');
```

### 시나리오 2: Internal Code가 없는 경우

채널별로 완전히 독립적인 제품인 경우:

```sql
-- Amazon만 있는 제품
INSERT INTO sku_master (sku, channel, product_name, amazon_account_name)
VALUES ('AMZ-ONLY-001', 'amazon_us', 'Amazon 전용 제품', 'Amazon Account 1');
```

## 🎯 채널별 특화 정보

채널별로 필요한 정보가 다를 수 있으므로, `channel_specific_data` JSON 필드를 사용합니다:

### Amazon US
```json
{
  "child_asin": "B08XYZ123",
  "amazon_account_name": "Account 1",
  "rank": 150,
  "fba_settings": {...}
}
```

### TikTok Shop
```json
{
  "tiktok_product_id": "12345",
  "seller_id": "67890",
  "tiktok_specific_field": "..."
}
```

### Shopify
```json
{
  "shopify_product_id": "98765",
  "shop_name": "myshop",
  "shopify_specific_field": "..."
}
```

## 📊 뷰: `product_sku_mapping`

제품과 SKU의 매핑을 한눈에 볼 수 있는 뷰:

```sql
SELECT * FROM product_sku_mapping 
WHERE internal_code = 'PROD-001';
```

결과:
```
internal_code | product_name | sku          | channel      | child_asin
PROD-001      | 비타민C      | AMZ-PROD-001 | amazon_us    | B08XYZ123
PROD-001      | 비타민C      | TTK-PROD-001 | tiktok_shop  | NULL
```

## ✅ 장점

1. **중복 제거**: 공통 정보는 한 곳에만 저장
2. **유연성**: 채널별로 다른 정보 구조 지원
3. **확장성**: 새로운 채널 추가 시 쉽게 확장 가능
4. **일관성**: Internal Code로 모든 채널의 제품을 연결

## 🔄 마이그레이션 가이드

기존 데이터가 있다면:

1. `product_master`에 제품 정보 추가
2. `sku_master`의 `internal_code` 필드 업데이트
3. 채널별 특화 정보는 `channel_specific_data` JSON 필드에 저장

