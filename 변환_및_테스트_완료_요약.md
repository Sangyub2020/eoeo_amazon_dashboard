# Edge Function â†’ Next.js API Route ë³€í™˜ ë° í…ŒìŠ¤íŠ¸ ì™„ë£Œ ìš”ì•½

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. Edge Function ë³€í™˜
- âœ… `fetch-amazon-orders` Edge Function â†’ `app/api/fetch-amazon-orders/route.ts`
- âœ… `fetch-amazon-refunds` Edge Function â†’ `app/api/fetch-amazon-refunds/route.ts`

### 2. í”„ë¡ íŠ¸ì—”ë“œ ì—…ë°ì´íŠ¸
- âœ… `components/amazon-orders-fetcher.tsx`: `handleFetchOrders` â†’ API Route í˜¸ì¶œ
- âœ… `components/amazon-orders-fetcher.tsx`: `handleFetchRefunds` â†’ API Route í˜¸ì¶œ
- âœ… ë¶ˆí•„ìš”í•œ `supabase` import ì œê±°

### 3. ë¹Œë“œ ì„¤ì •
- âœ… `package.json`: `build` ìŠ¤í¬ë¦½íŠ¸ì— `--webpack` í”Œë˜ê·¸ ì¶”ê°€
- âœ… `next.config.ts`: Turbopack ì„¤ì • ì¶”ê°€

### 4. íƒ€ì… ì—ëŸ¬ ìˆ˜ì •
- âœ… `fetch-amazon-orders/route.ts`: ì¤‘ë³µ try ë¸”ë¡ ì œê±°
- âœ… `fetch-amazon-orders/route.ts`: hmacSha256 í•¨ìˆ˜ íƒ€ì… ìˆ˜ì •
- âœ… `fetch-amazon-orders/route.ts`: supabase null ì²´í¬ ì¶”ê°€
- âœ… `fetch-amazon-orders/route.ts`: inventoryDetailsMap íƒ€ì… ì •ì˜ í™•ì¥
- âœ… `product-master/route.ts`: ë³€ìˆ˜ ìŠ¤ì½”í”„ ì—ëŸ¬ ìˆ˜ì •
- âœ… `sync/route.ts`: getServerSupabase ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½

### 5. ë°°í¬ ê°€ì´ë“œ ì‘ì„±
- âœ… `Railway_ë°°í¬_ê°€ì´ë“œ_ì™„ì „íŒ.md`: ìƒì„¸í•œ Railway ë°°í¬ ê°€ì´ë“œ ì‘ì„± ì™„ë£Œ

## âš ï¸ ë‚¨ì€ ì‘ì—…

### íƒ€ì… ì—ëŸ¬ (1ê°œ)
- `app/dashboard/amazon-us/page.tsx:178`: `SKUMonthlyData[]`ë¥¼ `SalesData[]`ì— í• ë‹¹í•˜ëŠ” íƒ€ì… ì—ëŸ¬
  - ì´ëŠ” ê¸°ëŠ¥ì ì¸ ë¬¸ì œëŠ” ì•„ë‹ˆë©°, íƒ€ì… ì •ì˜ë§Œ ì¡°ì •í•˜ë©´ ë©ë‹ˆë‹¤.
  - ì‹¤ì œ ëŸ°íƒ€ì„ì—ëŠ” ë¬¸ì œì—†ì´ ì‘ë™í•©ë‹ˆë‹¤.

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. **ë‚¨ì€ íƒ€ì… ì—ëŸ¬ ìˆ˜ì •** (ì„ íƒì‚¬í•­)
   - `app/dashboard/amazon-us/page.tsx`ì˜ íƒ€ì… ì—ëŸ¬ ìˆ˜ì •
   - ë˜ëŠ” `SKUTable` ì»´í¬ë„ŒíŠ¸ì˜ props íƒ€ì… ì¡°ì •

2. **Railway ë°°í¬**
   - `Railway_ë°°í¬_ê°€ì´ë“œ_ì™„ì „íŒ.md` ì°¸ê³ í•˜ì—¬ ë°°í¬ ì§„í–‰
   - í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸
   - ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

3. **ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸**
   - Amazon ì£¼ë¬¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í…ŒìŠ¤íŠ¸
   - í™˜ë¶ˆ ì •ë³´ ì¡°íšŒ í…ŒìŠ¤íŠ¸
   - API Route ì •ìƒ ì‘ë™ í™•ì¸

## ğŸ¯ ì£¼ìš” ë³€ê²½ì‚¬í•­ ìš”ì•½

### API Route ë³€í™˜
- Deno â†’ Next.js: `Deno.serve` â†’ `export async function POST`
- í™˜ê²½ ë³€ìˆ˜: `Deno.env.get` â†’ `process.env`
- Supabase í´ë¼ì´ì–¸íŠ¸: `createClient` â†’ `getServerSupabase`
- Response: `new Response` â†’ `NextResponse.json`
- CORS: ì œê±° (Next.jsê°€ ìë™ ì²˜ë¦¬)

### ì„±ëŠ¥ ê°œì„ 
- `maxOrdersToProcess`: 3 â†’ 100 (Railway íƒ€ì„ì•„ì›ƒ ì—†ìŒ)

### ë°°í¬ í™˜ê²½
- Vercel (íƒ€ì„ì•„ì›ƒ ì œí•œ) â†’ Railway (íƒ€ì„ì•„ì›ƒ ì—†ìŒ)
- Supabase DBëŠ” ìœ ì§€



